on:
  #push:
  pull_request:
   types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write
#on:
#  push:
#  pull_request:
#   types: [opened, synchronize]

#permissions:
#  contents: read
#  pull-requests: write

jobs:
  init_job:
    outputs:
      output1: ${{ steps.step1.outputs.test }}
      output2: ${{ steps.step2.outputs.test2 }}
      output3: ${{ steps.step3.outputs.test3 }}
      output_youtrack_task_id: ${{ steps.step3.outputs.youtrack_task_id }}
    runs-on: ubuntu-20.04
    steps:
      - id: step1
        run: echo "test=hello" >> $GITHUB_OUTPUT
      - id: step2
        run: echo "test2=world" >> $GITHUB_OUTPUT  
        
      - name : Print Title of PR
        run: echo "The Title of your PR is ${{ github.event.pull_request.title }}"
        
      - name : Print Title of PR 1 body 
        run: echo "The Title of your PR is ${{ github.event.pull_request.body  }}"
        
      - name: Extract task id
        id: step3
        env:
          PULL_REQUEST_BODY: ${{ github.event.pull_request.body }}
        run: |
          echo "PULL_REQUEST_TITLE = ${{ github.event.pull_request.title }}"
          echo "PULL_REQUEST_BODY = ${{ env.PULL_REQUEST_BODY }}"

          echo "youtrack_task_id_local=($(echo ${PULL_REQUEST_BODY} | grep -Eo "\[EMAM3MT5-[0-9]+" | cut -c 2-))" >> $GITHUB_ENV
          echo "OUT = ${{ env.youtrack_task_id_local }}" 
          echo "youtrack_task_id=${{ env.youtrack_task_id_local }} >> $GITHUB_OUTPUT
          #echo "youtrack_task_id=($(echo ${PULL_REQUEST_BODY} | grep -Eo "\[EMAM3MT5-[0-9]+" | cut -c 2-))" >> $GITHUB_OUTPUT
          #echo "output_youtrack_task_id1 = ${{ env.output_youtrack_task_id }}"
          #echo "output_youtrack_task_id3 = ${{ env.youtrack_task_id }}"    

  print_title_of_pr:
    runs-on: windows-latest
    needs: init_job
    steps:
    - name : Print Outputs
      run: echo "Outputs first = ${{needs.init_job.outputs.output1}} second = ${{needs.init_job.outputs.output2}}  third = ${{needs.init_job.outputs.output3}} output_youtrack_task_id = ${{needs.init_job.outputs.output_youtrack_task_id}} "    
